window.console||(console={log:function(){}});var textAngular=angular.module("textAngular",["ngSanitize"]);textAngular.directive("textAngular",["$compile","$window","$document","$rootScope","$timeout","taFixChrome",function(t,e,a,n,l,o){function i(t,e){for(var a in e)e[a]&&e[a].constructor&&e[a].constructor===Object?(t[a]=t[a]||{},arguments.callee(t[a],e[a])):t[a]=e[a];return t}console.log("Thank you for using textAngular! http://www.textangular.com"),n.textAngularOpts=i({toolbar:[["h1","h2","h3","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight"],["html"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",textEditor:"form-control",htmlEditor:"form-control"}},null!=n.textAngularOpts?n.textAngularOpts:{});var s=function(t){t=t.toLowerCase();var e=a[0].queryCommandValue("formatBlock").toLowerCase();return e===t||e===t};return n.textAngularTools=i({html:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>Toggle HTML</button>",action:function(){var t=this;this.$parent.showHtml=!this.$parent.showHtml,this.$parent.showHtml?l(function(){return t.$parent.displayElements.html[0].focus()},100):l(function(){return t.$parent.displayElements.text[0].focus()},100),this.active=this.$parent.showHtml}},h1:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H1</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H1>")},activeState:function(){return s("h1")}},h2:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H2</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H2>")},activeState:function(){return s("h2")}},h3:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>H3</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<H3>")},activeState:function(){return s("h3")}},p:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>P</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<P>")},activeState:function(){return s("p")}},pre:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'>pre</button>",action:function(){return this.$parent.wrapSelection("formatBlock","<PRE>")},activeState:function(){return s("pre")}},ul:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ul'></i></button>",action:function(){return this.$parent.wrapSelection("insertUnorderedList",null)},activeState:function(){return a[0].queryCommandState("insertUnorderedList")}},ol:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-list-ol'></i></button>",action:function(){return this.$parent.wrapSelection("insertOrderedList",null)},activeState:function(){return a[0].queryCommandState("insertOrderedList")}},quote:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-quote-right'></i></button>",action:function(){return this.$parent.wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return s("blockquote")}},undo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-undo'></i></button>",action:function(){return this.$parent.wrapSelection("undo",null)}},redo:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-repeat'></i></button>",action:function(){return this.$parent.wrapSelection("redo",null)}},bold:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-bold'></i></button>",action:function(){return this.$parent.wrapSelection("bold",null)},activeState:function(){return a[0].queryCommandState("bold")}},justifyLeft:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-left'></i></button>",action:function(){return this.$parent.wrapSelection("justifyLeft",null)},activeState:function(){return a[0].queryCommandState("justifyLeft")}},justifyRight:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-right'></i></button>",action:function(){return this.$parent.wrapSelection("justifyRight",null)},activeState:function(){return a[0].queryCommandState("justifyRight")}},justifyCenter:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-align-center'></i></button>",action:function(){return this.$parent.wrapSelection("justifyCenter",null)},activeState:function(){return a[0].queryCommandState("justifyCenter")}},italics:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-italic'></i></button>",action:function(){return this.$parent.wrapSelection("italic",null)},activeState:function(){return a[0].queryCommandState("italic")}},underline:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-underline'></i></button>",action:function(){return this.$parent.wrapSelection("underline",null)},activeState:function(){return a[0].queryCommandState("underline")}},clear:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-ban'></i></button>",action:function(){return this.$parent.wrapSelection("removeFormat",null)}},insertImage:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-picture-o'></i></button>",action:function(){var t;if(t=prompt("Please enter an image URL to insert","http://"),""!==t)return this.$parent.wrapSelection("insertImage",t)}},insertLink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-link'></i></button>",action:function(){var t;if(t=prompt("Please enter an URL to insert","http://"),""!==t)return this.$parent.wrapSelection("createLink",t)}},unlink:{display:"<button type='button' ng-click='action()' ng-class='displayActiveToolClass(active)'><i class='fa fa-unlink'></i></button>",action:function(){return this.$parent.wrapSelection("unlink",null)}}},null!=n.textAngularTools?n.textAngularTools:{}),{require:"ngModel",scope:{},restrict:"EA",link:function(e,i,s,r){var c,u,p,d,m,f;angular.extend(e,n.textAngularOpts,{wrapSelection:function(t,a){document.execCommand(t,!1,a),"insertUnorderedList"!==t&&"insertOrderedList"!==t||o(e.displayElements.text),e.showHtml?e.displayElements.html[0].focus():e.displayElements.text[0].focus(),e.updateSelectedStyles(),e.showHtml||e.updateTaBindtext()},showHtml:!1}),s.taToolbar&&(e.toolbar=e.$eval(s.taToolbar)),s.taFocussedClass&&(e.classes.focussed=e.$eval(s.taFocussedClass)),s.taToolbarClass&&(e.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(e.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(e.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(e.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taTextEditorClass&&(e.classes.textEditor=s.taTextEditorClass),s.taHtmlEditorClass&&(e.classes.htmlEditor=s.taHtmlEditorClass),e.displayElements={toolbar:angular.element("<div></div>"),forminput:angular.element("<input type='hidden' style='display: none;'>"),html:angular.element("<textarea ng-show='showHtml' ta-bind='html' ng-model='html' ></textarea>"),text:angular.element("<div contentEditable='true' ng-hide='showHtml' ta-bind='text' ng-model='text' ></div>")},i.append(e.displayElements.toolbar),i.append(e.displayElements.text),i.append(e.displayElements.html),s.name&&(e.displayElements.forminput.attr("name",s.name),i.append(e.displayElements.forminput)),t(e.displayElements.text)(e),t(e.displayElements.html)(e),i.addClass("ta-root"),e.displayElements.toolbar.addClass("ta-toolbar "+e.classes.toolbar),e.displayElements.text.addClass("ta-text ta-editor "+e.classes.textEditor),e.displayElements.html.addClass("ta-html ta-editor "+e.classes.textEditor),i.on("focusin",function(){i.addClass(e.classes.focussed),l(function(){i.triggerHandler("focus")},0)}),i.on("focusout",function(){l(function(){a[0].activeElement!==e.displayElements.html[0]&&a[0].activeElement!==e.displayElements.text[0]&&(i.removeClass(e.classes.focussed),l(function(){i.triggerHandler("blur")},0))},0)}),e.tools={};for(var y=0;y<e.toolbar.length;y++){c=e.toolbar[y],u=angular.element("<div></div>"),u.addClass(e.classes.toolbarGroup);for(var g=0;g<c.length;g++){m=c[g],f=angular.element(n.textAngularTools[m].display),f.addClass(e.classes.toolbarButton),f.attr("unselectable","on"),f.attr("ng-disabled","showHtml()");var v=angular.extend(e.$new(!0),n.textAngularTools[m],{name:m,showHtml:function(){return"html"!==this.name&&this.$parent.showHtml},displayActiveToolClass:function(t){return t?this.$parent.classes.toolbarButtonActive:""}});e.tools[m]=v,u.append(t(f)(v))}e.displayElements.toolbar.append(u)}r.$render=function(){if(e.displayElements.forminput.val(r.$viewValue),void 0!==r.$viewValue&&a[0].activeElement!==e.displayElements.html[0]&&a[0].activeElement!==e.displayElements.text[0]){var t=r.$viewValue||"";e.text=t,e.html=t}},e.$watch("text",function(t,a){e.html=t,r.$setViewValue(t),e.displayElements.forminput.val(t)}),e.$watch("html",function(t,a){e.text=t,r.$setViewValue(t),e.displayElements.forminput.val(t)}),e.bUpdateSelectedStyles=!1,e.updateSelectedStyles=function(){for(var t=0;t<e.toolbar.length;t++)for(var a=e.toolbar[t],n=0;n<a.length;n++)m=a[n],null!=e.tools[m].activeState&&(e.tools[m].active=e.tools[m].activeState.apply(e));this.bUpdateSelectedStyles&&l(this.updateSelectedStyles,200)},p=function(t){e.bUpdateSelectedStyles=!0,e.$apply(function(){e.updateSelectedStyles()})},e.displayElements.html.on("keydown",p),e.displayElements.text.on("keydown",p),d=function(t){e.bUpdateSelectedStyles=!1},e.displayElements.html.on("keyup",d),e.displayElements.text.on("keyup",d),mouseup=function(t){e.$apply(function(){e.updateSelectedStyles()})},e.displayElements.html.on("mouseup",mouseup),e.displayElements.text.on("mouseup",mouseup)}}}]).directive("taBind",["$sanitize","$document","taFixChrome",function(t,e,a){return{require:"ngModel",scope:{taBind:"@"},link:function(n,l,o,i){var s="textarea"!==l[0].tagName.toLowerCase()&&"input"!==l[0].tagName.toLowerCase()&&void 0!==l.attr("contenteditable"),r=function(){var t=a(angular.element("<div>").append(l.html())).html();return"html"===n.taBind&&s&&(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),t};n.$parent["updateTaBind"+n.taBind]=function(){var t=r(),e=i.$parsers;i.$parsers=[],i.$oldViewValue=t,i.$setViewValue(t),i.$parsers=e},s&&l.on("keyup",function(t){i.$setViewValue(r())}),i.$parsers.push(function(e){void 0===i.$oldViewValue&&(i.$oldViewValue=e);try{t(e)}catch(a){return i.$oldViewValue}return i.$oldViewValue=e,e}),i.$render=function(){if(void 0!==i.$viewValue)if(e[0].activeElement!==l[0]){var t=i.$viewValue||"";i.$oldViewValue=t,"text"===n.taBind?(l.html(t),l.find("a").on("click",function(t){return t.preventDefault(),!1})):s||"textarea"!==l[0].tagName.toLowerCase()&&"input"!==l[0].tagName.toLowerCase()?l.html(t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")):l.val(t)}else s||l.val(t)}}}}]).factory("taFixChrome",function(){var t=function(t){for(var e=angular.element(t).find("span"),a=0;a<e.length;a++){var n=angular.element(e[a]);n.attr("style")&&n.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(n.next().length>0&&"BR"===n.next()[0].tagName&&n.next().remove(),n.replaceWith(n.html()))}var l=t.html().replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");return t.html(l),t};return t});
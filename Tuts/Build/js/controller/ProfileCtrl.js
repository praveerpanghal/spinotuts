app.controller("ProfileCtrl",["$route","$http","JsonDataService","myAppURLs","Upload","fileUpload","EncodeService","httpCall",function(t,e,o,n,s,i,r,a){function u(t){for(var e=t.length,o=new ArrayBuffer(e),n=new Uint8Array(o),s=0;s<e;s++)n[s]=t.charCodeAt(s);return o}var d=this,c=o.GetJsonInfo(t.current.templateUrl);a.GetMethod(c).then(function(t){d.JsonVals=t},function(t){$log.info(t)});var l=JSON.parse(r.encodelogval(sessionStorage.UserInfo));$(document).click(function(){$(".postArticleCont").hide(),d.userupdatemsg="",d.userupdatemsg1=""});var f=n.GetCountryList;a.GetMethod(f).then(function(t){d.countrylists=t.GetCountryListResult},function(t){$log.info(t)}),d.selectedItemChanged=function(t){var e=n.GetStateList,o={country_id:t};a.PostMethod(e,o).then(function(t){d.GetStateLists=t.GetStateListResult},function(t){$log.info(t)})},d.getdata=function(){var t=n.GetUserProfileDetails,e={user_id:l.UserId};a.PostMethod(t,e).then(function(t){d.userprofiledetails=t.GetUserProfileDetailsResult[0],d.selectedItem(d.userprofiledetails.country_id,d.userprofiledetails.state_id)},function(t){$log.info(t)})},d.getdata(),d.selectedItem=function(t,e){var o=n.GetStateList,s={country_id:t};a.PostMethod(o,s).then(function(t){d.GetStateLists=t.GetStateListResult;var o=d.GetStateLists.map(function(t){return t.state_id}).indexOf(e);d.state_id=d.GetStateLists[o].state_name},function(t){$log.info(t)})},d.foucs=function(){$("button").attr("disabled",!1)},d.mobbutton=!0,d.dobbutton=!0,d.editbutton=!0,d.adrsbut=!0,d.citybutton=!0,d.countrybut=!0,d.run=function(t){switch(t){case"dobbutton":d.dobbutton=!1;break;case"mobbutton":d.mobbutton=!1;break;case"editbutton":d.editbutton=!1;break;case"adrsbut":d.adrsbut=!1;break;case"citybutton":d.citybutton=!1;break;case"countrybut":d.countrybut=!1}},d.sel=!1,d.updateprofile=function(t,o){if(d.picFile){var s=u(atob(t.split(",")[1])),i=new File([s],d.picFile.name,{type:"'image/jpeg"}),r="/multer",c=new FormData;c.append("file",i),e.post(r,c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(t){d.eselect=!1}).error(function(){console.log("error!!")}),d.profile_pic="/images/uploads/"+l.UserId+"/"+i.name}else d.profile_pic=d.userprofiledetails.profile_pic;var f=n.UpdateUserProfile,p=new Object;p.user_id=l.UserId,p.birth_date=o.birth_date,p.mobile=o.mobile,p.email=o.email,p.address=o.address,p.city=o.city,p.country_id=o.country_id,p.state_id=o.state_id,p.profile_pic=d.profile_pic||"",a.PostMethod(f,p).then(function(t){1==t.UpdateUserProfileResult?(d.userupdatemsg="Profile updated successfully",d.getdata(),d.mobbutton=!0,d.dobbutton=!0,d.editbutton=!0,d.adrsbut=!0,d.citybutton=!0,d.countrybut=!0,$("button").attr("disabled",!0)):alert("profile not updated")},function(t){$log.info(t)})},d.changepwds=[],d.changepwd=function(){d.master={};var t=n.ChangePassword,e={user_id:l.UserId,old_password:d.changepwds.curpwd,new_password:d.changepwds.pw1};a.PostMethod(t,e).then(function(t){1==t.ChangePasswordResult?(d.userupdatemsg1="password updated successfully",d.changepwds=angular.copy(d.master),d.myForm.$setPristine(),d.myForm.$setUntouched()):t.ChangePasswordResult==-1?d.userupdatemsg1="old password is wrong":alert("user does  not exists")},function(t){$log.info(t)})}}]);
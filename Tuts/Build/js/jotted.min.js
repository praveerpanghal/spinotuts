!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Jotted=e()}(this,function(){"use strict";function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return Object.keys(t).forEach(function(e){n[e]=t[e]}),Object.keys(e).forEach(function(i){"undefined"!=typeof n[i]?n[i]=t[i]:n[i]=e[i]}),n}function e(t,e){var n=new window.XMLHttpRequest;n.open("GET",t),n.responseType="text",n.onload=function(){200===n.status?e(null,n.responseText):e(t,n)},n.onerror=function(t){e(t)},n.send()}function n(t,e,n,o,r){return function(e,s){e&&o.push(e),t++,t<n.length?i(t,s,n,o,r):r(o,s)}}function i(t,e,i,o,r){i[t](e,n.apply(this,arguments))}function o(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=[];return t.length?void i(0,e,t,o,n):n(o,e)}function r(t,e){var n=null,i=null;return function(){var o=this,r=arguments;n?i=!0:t.apply(this,arguments),clearTimeout(n),n=setTimeout(function(){i&&t.apply(o,r),n=null,i=null},e)}}function s(t,e){if(!t.className)return!1;var n=" "+t.className+" ";return e=" "+e+" ",n.indexOf(e)!==-1}function a(t,e){return s(t,e)?t.className:(t.className&&(e=" "+e),t.className+=e,t.className)}function c(t,e){var n=" "+e,i=e+" ";return t.className.indexOf(n)!==-1?t.className=t.className.replace(n,""):t.className.indexOf(i)!==-1?t.className=t.className.replace(i,""):t.className=t.className.replace(e,""),t.className}function u(t,e){return t.getAttribute("data-"+e)}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=t(i,E);for(var r in o){var s=r.length;if(n.slice(-s++)==="."+r)return o[r]}for(var a in o)if(e===a)return o[a];return e}function d(){return'\n    <ul class="jotted-nav">\n <li class="jotted-nav-item jotted-nav-item-html">\n        <a href="#" data-jotted-type="html">\n          HTML\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-css">\n        <a href="#" data-jotted-type="css">\n          CSS\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-js">\n        <a href="#" data-jotted-type="js">\n          JavaScript\n        </a>\n      </li>\n        <li class="jotted-nav-item jotted-nav-item-result">\n        <a href="#" data-jotted-type="result">\n          Result\n        </a>\n      </li>\n        </ul>\n    <div class="jotted-pane jotted-pane-result"><iframe></iframe></div>\n    <div class="jotted-pane jotted-pane-html"></div>\n    <div class="jotted-pane jotted-pane-css"></div>\n    <div class="jotted-pane jotted-pane-js"></div>\n  '}function h(t){return"jotted-pane-active-"+t}function f(){return"jotted"}function p(t){return"jotted-has-"+t}function v(t){return"jotted-editor jotted-editor-"+t}function y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return'\n    <textarea data-jotted-type="'+t+'" data-jotted-file="'+e+'"></textarea>\n    <div class="jotted-status"></div>\n  '}function g(t){return"\n    <p>"+t+"</p>\n  "}function m(t){return"jotted-status-"+t}function j(t){return"jotted-status-active-"+t}function b(t){return"jotted-plugin-"+t}function w(t){return"Loading <strong>"+t+"</strong>.."}function k(t){return"There was an error loading <strong>"+t+"</strong>."}function S(t){for(var e in M){var n=M[e];if(n._id===t)return n}throw new Error("Plugin "+t+" is not registered.")}function x(t,e){e._id=t,M.push(e)}function C(){var t=this;this._get("options").plugins.forEach(function(e){var n=void 0,i=void 0,o={};"string"==typeof e?i=e:"object"===("undefined"==typeof e?"undefined":L(e))&&(i=e.name,o=e.options||{}),n=S(i),t._get("plugins")[e]=new n(t,o),a(t._get("$container"),b(i))})}function $(t){t.plugin("render",q),t.plugin("scriptless",O),t.plugin("ace",H),t.plugin("codemirror",F),t.plugin("less",I),t.plugin("coffeescript",A),t.plugin("stylus",W),t.plugin("babel",J),t.plugin("markdown",P),t.plugin("console",R),t.plugin("play",D),t.plugin("pen",V)}var E={html:"html",css:"css",js:"javascript",less:"less",styl:"stylus",coffee:"coffeescript"},L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_=(function(){function t(t){this.value=t}function e(e){function n(t,e){return new Promise(function(n,o){var a={key:t,arg:e,resolve:n,reject:o,next:null};s?s=s.next=a:(r=s=a,i(t,e))})}function i(n,r){try{var s=e[n](r),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){i("next",t)},function(t){i("throw",t)}):o(s.done?"return":"normal",s.value)}catch(c){o("throw",c)}}function o(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}r=r.next,r?i(r.key,r.arg):s=null}var r,s;this._invoke=n,"function"!=typeof e["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype["throw"]=function(t){return this._invoke("throw",t)},e.prototype["return"]=function(t){return this._invoke("return",t)},{wrap:function(t){return function(){return new e(t.apply(this,arguments))}},await:function(e){return new t(e)}}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),T=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),M=[],N=function(){function t(){_(this,t),this.topics={},this.callbacks={}}return T(t,[{key:"find",value:function(t){return this.topics[t]=this.topics[t]||[],this.topics[t]}},{key:"subscribe",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:90,i=this.find(t);e._priority=n,i.push(e),i.sort(function(t,e){return t._priority>e._priority?1:e._priority>t._priority?-1:0})}},{key:"remover",value:function(t,e){t.forEach(function(){if(!e)return void(t.length=0);var n=[].indexOf.call(t,e);n!==-1&&t.splice(n,1)})}},{key:"unsubscribe",value:function(t,e){var n=this.find(t);this.remover(n,e),this.callbacks[t]=this.callbacks[t]||[],this.remover(this.callbacks[t],e)}},{key:"publish",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.find(t),i=[];n.forEach(function(t){i.push(t)}),o(i,e,this.runCallbacks(t))}},{key:"runCallbacks",value:function(t){var e=this;return function(n,i){e.callbacks[t]=e.callbacks[t]||[],e.callbacks[t].forEach(function(t){t(n,i)})}}},{key:"done",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this.callbacks[t]=this.callbacks[t]||[],this.callbacks[t].push(e)}}]),t}(),q=function(){function e(n,i){_(this,e),i=t(i,{});var o=!!("srcdoc"in document.createElement("iframe")),r=n.$container.querySelector(".jotted-pane-result iframe"),s="",a={html:"",css:"",js:""};window.addEventListener("message",this.domready.bind(this)),n.on("change",this.change.bind(this),100),this.supportSrcdoc=o,this.content=a,this.frameContent=s,this.$resultFrame=r,this.callbacks=[],this.index=0,this.lastCallback=function(){}}return T(e,[{key:"template",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return"\n      <!doctype html>\n      <html>\n        <head>\n          <script>\n            (function () {\n              window.addEventListener('DOMContentLoaded', function () {\n                window.parent.postMessage(JSON.stringify({\n                  type: 'jotted-dom-ready'\n                }), '*')\n              })\n            }())\n          </script>\n\n          <style>"+t+"</style>\n        </head>\n        <body>\n          "+e+"\n\n          <!--\n            Jotted:\n            Empty script tag prevents malformed HTML from breaking the next script.\n          -->\n          <script></script>\n          <script>"+n+"</script>\n        </body>\n      </html>\n    "}},{key:"change",value:function(t,e){var n=this;this.content[t.type]=t.content;var i=this.frameContent;if(this.frameContent=this.template(this.content.css,this.content.html,this.content.js),this.lastCallback=function(){n.lastCallback=function(){},e(null,t)},t.forceRender!==!0&&this.frameContent===i)return void e(null,t);if(this.supportSrcdoc){var o=document.createElement("iframe");this.$resultFrame.parentNode.replaceChild(o,this.$resultFrame),this.$resultFrame=o,this.$resultFrame.contentWindow.document.open(),this.$resultFrame.contentWindow.document.write(this.frameContent),this.$resultFrame.contentWindow.document.close()}else{this.$resultFrame.setAttribute("data-srcdoc",this.frameContent);var r='javascript:window.frameElement.getAttribute("data-srcdoc");';this.$resultFrame.setAttribute("src",r),this.$resultFrame.contentWindow&&(this.$resultFrame.contentWindow.location=r)}}},{key:"domready",value:function(t){if(t.source===this.$resultFrame.contentWindow){var e={};try{e=JSON.parse(t.data)}catch(t){}"jotted-dom-ready"===e.type&&this.lastCallback()}}}]),e}(),O=function(){function e(n,i){_(this,e),i=t(i,{});var o=["application/javascript","application/ecmascript","application/x-ecmascript","application/x-javascript","text/ecmascript","text/javascript","text/javascript1.0","text/javascript1.1","text/javascript1.2","text/javascript1.3","text/javascript1.4","text/javascript1.5","text/jscript","text/livescript","text/x-ecmascript","text/x-javascript"];n.on("change",this.change.bind(this)),this.runScriptTypes=o}return T(e,[{key:"change",value:function(t,e){if("html"!==t.type)return e(null,t);var n=document.createElement("div");n.innerHTML=t.content;for(var i=null,o=n.querySelectorAll("script"),r=0;r<o.length;r++)i=o[r].getAttribute("type"),i&&this.runScriptTypes.indexOf(i)===-1||o[r].parentNode.removeChild(o[r]);t.content=n.innerHTML,e(null,t)}}]),e}(),H=function(){function e(n,i){_(this,e);var o,r=1;if(this.editor={},this.jotted=n,i=t(i,{}),"undefined"!=typeof window.ace){var s=n.$container.querySelectorAll(".jotted-editor");for(o=0;o<s.length;o++){var a=s[o].querySelector("textarea"),c=u(a,"jotted-type"),d=u(a,"jotted-file"),h=document.createElement("div");s[o].appendChild(h),this.editor[c]=window.ace.edit(h);var f=this.editor[c],p=t(i);f.getSession().setMode("ace/mode/"+l(c,d)),f.getSession().setOptions(p),f.$blockScrolling=1/0}n.on("change",this.change.bind(this),r)}}return T(e,[{key:"editorChange",value:function(t){var e=this;return function(){e.jotted.trigger("change",t)}}},{key:"change",value:function(t,e){var n=this.editor[t.type];t.aceEditor||(n.getSession().setValue(t.content),t.aceEditor=n,n.on("change",this.editorChange(t))),t.content=n.getValue(),e(null,t)}}]),e}(),F=function(){function e(n,i){_(this,e);var o,r=1;this.editor={},this.jotted=n;var s={html:"htmlmixed"};if(i=t(i,{lineNumbers:!0}),"undefined"!=typeof window.CodeMirror){var a=n.$container.querySelectorAll(".jotted-editor");for(o=0;o<a.length;o++){var c=a[o].querySelector("textarea"),d=u(c,"jotted-type"),h=u(c,"jotted-file");this.editor[d]=window.CodeMirror.fromTextArea(c,i),this.editor[d].setOption("mode",l(d,h,s))}n.on("change",this.change.bind(this),r)}}return T(e,[{key:"editorChange",value:function(t){var e=this;return function(){e.jotted.trigger("change",t)}}},{key:"change",value:function(t,e){var n=this.editor[t.type];t.cmEditor||(n.setValue(t.content),t.cmEditor=n,n.on("change",this.editorChange(t))),t.content=n.getValue(),e(null,t)}}]),e}(),I=function(){function e(n,i){_(this,e);var o=20;i=t(i,{}),"undefined"!=typeof window.less&&(n.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Less",n.on("change",this.change.bind(this),o))}return T(e,[{key:"isLess",value:function(t){return"css"===t.type&&(t.file.indexOf(".less")!==-1||""===t.file)}},{key:"change",value:function(t,e){this.isLess(t)?window.less.render(t.content,this.options,function(n,i){return n?e(n,t):(t.content=i.css,void e(null,t))}):e(null,t)}}]),e}(),A=function(){function e(n,i){_(this,e);var o=20;i=t(i,{}),"undefined"!=typeof window.CoffeeScript&&(n.$container.querySelector('a[data-jotted-type="js"]').innerHTML="CoffeeScript",n.on("change",this.change.bind(this),o))}return T(e,[{key:"isCoffee",value:function(t){return"js"===t.type&&(t.file.indexOf(".coffee")!==-1||""===t.file)}},{key:"change",value:function(t,e){if(this.isCoffee(t))try{t.content=window.CoffeeScript.compile(t.content)}catch(n){return e(n,t)}e(null,t)}}]),e}(),W=function(){function e(n,i){_(this,e);var o=20;i=t(i,{}),"undefined"!=typeof window.stylus&&(n.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Stylus",n.on("change",this.change.bind(this),o))}return T(e,[{key:"isStylus",value:function(t){return"css"===t.type&&(t.file.indexOf(".styl")!==-1||""===t.file)}},{key:"change",value:function(t,e){this.isStylus(t)?window.stylus(t.content,this.options).render(function(n,i){return n?e(n,t):(t.content=i,void e(null,t))}):e(null,t)}}]),e}(),J=function(){function e(n,i){_(this,e);var o=20;if(this.options=t(i,{}),"undefined"!=typeof window.Babel)this.babel=window.Babel;else{if("undefined"==typeof window.babel)return;this.babel={transform:window.babel}}n.$container.querySelector('a[data-jotted-type="js"]').innerHTML="ES2015",n.on("change",this.change.bind(this),o)}return T(e,[{key:"change",value:function(t,e){if("js"===t.type){try{t.content=this.babel.transform(t.content,this.options).code}catch(n){return e(n,t)}e(null,t)}else e(null,t)}}]),e}(),P=function(){function e(n,i){_(this,e);var o=20;this.options=t(i,{}),"undefined"!=typeof window.marked&&(window.marked.setOptions(i),n.$container.querySelector('a[data-jotted-type="html"]').innerHTML="Markdown",n.on("change",this.change.bind(this),o))}return T(e,[{key:"change",value:function(t,e){if("html"===t.type){try{t.content=window.marked(t.content)}catch(n){return e(n,t)}e(null,t)}else e(null,t)}}]),e}(),R=function(){function e(n,i){_(this,e),i=t(i,{autoClear:!1});var o=30,r=[],s=0,c="("+this.capture.toString()+")();",u={html:"",css:"",js:""},l=document.createElement("li");a(l,"jotted-nav-item jotted-nav-item-console"),l.innerHTML='<a href="#" data-jotted-type="console">JS Console</a>';var d=document.createElement("div");a(d,"jotted-pane jotted-pane-console"),d.innerHTML='\n      <div class="jotted-console-container">\n        <ul class="jotted-console-output"></ul>\n        <form class="jotted-console-input">\n          <input type="text">\n        </form>\n      </div>\n      <button class="jotted-button jotted-console-clear">Clear</button>\n    ',n.$container.appendChild(d),n.$container.querySelector(".jotted-nav").appendChild(l);var h=n.$container.querySelector(".jotted-console-container"),f=n.$container.querySelector(".jotted-console-output"),p=n.$container.querySelector(".jotted-console-input input"),v=n.$container.querySelector(".jotted-console-input"),y=n.$container.querySelector(".jotted-console-clear");v.addEventListener("submit",this.submit.bind(this)),p.addEventListener("keydown",this.history.bind(this)),y.addEventListener("click",this.clear.bind(this)),i.autoClear===!0&&n.on("change",this.autoClear.bind(this),o-1),n.on("change",this.change.bind(this),o),window.addEventListener("message",this.getMessage.bind(this)),this.$jottedContainer=n.$container,this.$container=h,this.$input=p,this.$output=f,this.history=r,this.historyIndex=s,this.logCaptureSnippet=c,this.contentCache=u,this.getIframe=this.getIframe.bind(this)}return T(e,[{key:"getIframe",value:function(){return this.$jottedContainer.querySelector(".jotted-pane-result iframe")}},{key:"getMessage",value:function(t){if(t.source===this.getIframe().contentWindow){var e={};try{e=JSON.parse(t.data)}catch(n){}"jotted-console-log"===e.type&&this.log(e.message)}}},{key:"autoClear",value:function(t,e){var n=t.content;"js"===t.type&&(n=n.replace(this.logCaptureSnippet,"")),t.forceRender!==!0&&this.contentCache[t.type]===n||this.clear(),this.contentCache[t.type]=n,e(null,t)}},{key:"change",value:function(t,e){return"js"!==t.type?e(null,t):(t.content.indexOf(this.logCaptureSnippet)===-1&&(t.content=""+this.logCaptureSnippet+t.content),void e(null,t))}},{key:"capture",value:function(){"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log||(window.console={log:function(){}});var t=Function.prototype.bind.call(window.console.log,window.console);window.console.log=function(){[].slice.call(arguments).forEach(function(t){window.parent.postMessage(JSON.stringify({type:"jotted-console-log",message:t}),"*")}),t.apply(t,arguments)}}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1],n=document.createElement("li");a(n,"jotted-console-log"),"undefined"!=typeof e&&a(n,"jotted-console-log-"+e),n.innerHTML=t,this.$output.appendChild(n)}},{key:"submit",value:function(t){var e=this.$input.value.trim();if(""===e)return t.preventDefault();this.history.push(e),this.historyIndex=this.history.length,this.log(e,"history"),0!==e.indexOf("return")&&(e="return "+e);try{var n=this.getIframe().contentWindow.eval("(function() {"+e+"})()");this.log(n)}catch(i){this.log(i,"error")}this.$input.value="",this.$container.scrollTop=this.$container.scrollHeight,t.preventDefault()}},{key:"clear",value:function(){this.$output.innerHTML=""}},{key:"history",value:function(t){var e=38,n=40,i=!1,o=this.$input.selectionStart;t.keyCode===e&&0!==this.historyIndex&&0===o&&(this.historyIndex--,i=!0),t.keyCode===n&&this.historyIndex!==this.history.length-1&&o===this.$input.value.length&&(this.historyIndex++,i=!0),i&&(this.$input.value=this.history[this.historyIndex])}}]),e}(),D=function(){function e(n,i){_(this,e),i=t(i,{firstRun:!0});var o=10,r={},s={};i.firstRun===!1&&(r={html:{type:"html",content:""},css:{type:"css",content:""},js:{type:"js",content:""}});var a=document.createElement("button");a.className="jotted-button jotted-button-play",a.innerHTML="Run",n.$container.appendChild(a),a.addEventListener("click",this.run.bind(this)),n.on("change",this.change.bind(this),o),this.cache=r,this.code=s,this.jotted=n}return T(e,[{key:"change",value:function(e,n){this.code[e.type]=t(e),"undefined"!=typeof this.cache[e.type]?(n(null,this.cache[e.type]),this.cache[e.type].forceRender=null):(this.cache[e.type]=t(e),n(null,e))}},{key:"run",value:function(){for(var e in this.code)this.cache[e]=t(this.code[e],{forceRender:!0}),this.jotted.trigger("change",this.cache[e])}}]),e}(),V=function(){function t(e,n){_(this,t);var i={html:{title:"HTML",classChecker:"jotted-has-html"},css:{title:"CSS",classChecker:"jotted-has-css"},js:{title:"JavaScript",classChecker:"jotted-has-js"},console:{title:"Console",classChecker:"jotted-plugin-console"}},o=[];for(var r in i)e.$container.classList.contains(i[r].classChecker)&&o.push(e.$container.querySelector(".jotted-pane-"+r));this.resizablePanes=[];for(var s=0;s<o.length;s++){for(var a=void 0,c=0;c<o[s].classList.length;c++)if(o[s].classList[c].indexOf("jotted-pane-")!==-1){a=o[s].classList[c].replace("jotted-pane-","");break}if(a){var u={container:o[s],expander:void 0};this.resizablePanes.push(u);var l=document.createElement("div");l.classList.add("jotted-pane-title"),l.innerHTML=i[a].title||a;var d=o[s].firstElementChild;d.insertBefore(l,d.firstChild),s>0&&(u.expander=document.createElement("div"),u.expander.classList.add("jotted-plugin-pen-expander"),u.expander.addEventListener("mousedown",this.startExpand.bind(this,e)),d.insertBefore(u.expander,l))}}}return T(t,[{key:"startExpand",value:function(t,e){var n=this.resizablePanes.filter(function(t){return t.expander===e.target}).shift(),i=this.resizablePanes[this.resizablePanes.indexOf(n)-1],o=100/parseInt(window.getComputedStyle(n.container.parentNode).width,10);n.container.parentNode.style.display="none",n.startX=e.clientX,n.startWidth=parseFloat(window.getComputedStyle(n.container).width,10),i.startWidth=parseFloat(window.getComputedStyle(i.container).width,10),n.container.parentNode.style.display="",n.mousemove=this.doDrag.bind(this,n,i,o),n.mouseup=this.stopDrag.bind(this,n),document.addEventListener("mousemove",n.mousemove,!1),document.addEventListener("mouseup",n.mouseup,!1)}},{key:"doDrag",value:function(t,e,n,i){var o=e.startWidth+(i.clientX-t.startX)*n,r=t.startWidth-(i.clientX-t.startX)*n,s=10;o>=s&&r>=s&&(t.container.style.maxWidth="none",e.container.style.maxWidth="none",e.container.style.width=o+"%",t.container.style.width=r+"%")}},{key:"stopDrag",value:function(t,e){document.removeEventListener("mousemove",t.mousemove,!1),document.removeEventListener("mouseup",t.mouseup,!1)}}]),t}(),X=function(){function n(e,i){if(_(this,n),!e)throw new Error("Can't find Jotted container.");var o={};this._get=function(t){return o[t]},this._set=function(t,e){return o[t]=e,o[t]};var s=this._set("options",t(i,{files:[],showBlank:!1,runScripts:!0,pane:"result",debounce:250,plugins:[]}));s.plugins.push("render"),s.runScripts===!1&&s.plugins.push("scriptless"),this._set("cachedContent",{html:null,css:null,js:null});var c=this._set("pubsoup",new N);this._set("trigger",this.trigger()),this._set("on",function(){c.subscribe.apply(c,arguments)}),this._set("off",function(){c.unsubscribe.apply(c,arguments)});var u=this._set("done",function(){c.done.apply(c,arguments)});u("change",this.errors.bind(this));var l=this._set("$container",e);l.innerHTML=d(),a(l,f());var v=this._set("paneActive",s.pane);a(l,h(v)),this._set("$status",{});for(var y=["html","css","js"],g=0;g<y.length;g++){var m=y[g];this.markup(m)}l.addEventListener("keyup",r(this.change.bind(this),s.debounce)),l.addEventListener("change",r(this.change.bind(this),s.debounce)),l.addEventListener("click",this.pane.bind(this)),this.$container=this._get("$container"),this.on=this._get("on"),this.off=this._get("off"),this.done=this._get("done"),this.trigger=this._get("trigger"),this.paneActive=this._get("paneActive"),this._set("plugins",{}),C.call(this);for(var j=["html","css","js"],b=0;b<j.length;b++){var w=j[b];this.load(w)}if(s.showBlank)for(var k=["html","css","js"],S=0;S<k.length;S++){var x=k[S];a(l,p(x))}}return T(n,[{key:"findFile",value:function(t){var e={},n=this._get("options");for(var i in n.files){var o=n.files[i];if(o.type===t)return o}return e}},{key:"markup",value:function(t){var e=this._get("$container"),n=e.querySelector(".jotted-pane-"+t),i=this.findFile(t),o=document.createElement("div");o.innerHTML=y(t,i.url),o.className=v(t),n.appendChild(o),this._get("$status")[t]=n.querySelector(".jotted-status"),"undefined"==typeof i.url&&"undefined"==typeof i.content||a(e,p(t))}},{key:"load",value:function(t){var n=this,i=this.findFile(t),o=this._get("$container").querySelector(".jotted-pane-"+t+" textarea");"undefined"!=typeof i.content?this.setValue(o,i.content):"undefined"!=typeof i.url?(this.status("loading",[w(i.url)],{type:t,file:i}),e(i.url,function(e,i){return e?void n.status("error",[k(e)],{type:t}):(n.clearStatus("loading",{type:t}),void n.setValue(o,i))})):this.setValue(o,"")}},{key:"setValue",value:function(t,e){t.value=e,this.change({target:t})}},{key:"change",value:function(t){var e=u(t.target,"jotted-type");if(e){var n=this._get("cachedContent");n[e]!==t.target.value&&(n[e]=t.target.value,this.trigger("change",{type:e,file:u(t.target,"jotted-file"),content:n[e]}))}}},{key:"errors",value:function(t,e){this.status("error",t,e)}},{key:"pane",value:function(t){if(u(t.target,"jotted-type")){var e=this._get("$container"),n=this._get("paneActive");c(e,h(n)),n=this._set("paneActive",u(t.target,"jotted-type")),a(e,h(n)),t.preventDefault()}}},{key:"status",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.length)return this.clearStatus(t,n);var i=this._get("$status");a(i[n.type],m(t)),a(this._get("$container"),j(n.type));var o="";e.forEach(function(t){o+=g(t)}),i[n.type].innerHTML=o}},{key:"clearStatus",value:function(t,e){var n=this._get("$status");c(n[e.type],m(t)),c(this._get("$container"),j(e.type)),n[e.type].innerHTML=""}},{key:"trigger",value:function(){var t=this._get("options"),e=this._get("pubsoup");if(t.debounce===!1)return function(){e.publish.apply(e,arguments)};var n={},i={};return function(o){var r=arguments,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=s.type,c=void 0===a?"default":a;n[c]?i[c]=!0:e.publish.apply(e,arguments),clearTimeout(n[c]),n[c]=setTimeout(function(){i[c]&&e.publish.apply(e,r),i[c]=null,n[c]=null},t.debounce)}}}]),n}();return X.plugin=function(){return x.apply(this,arguments)},$(X),X});